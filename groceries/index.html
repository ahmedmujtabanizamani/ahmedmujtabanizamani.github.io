<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GM House Groceries üè†</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root { 
            --primary: #27ae60; --edit: #f39c12; --danger: #e74c3c; 
            --important: #fff9db; --imp-border: #f1c40f; --dark: #2c3e50;
            --bg: #f4f6f8; --white: #ffffff;
        }

        body { font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; padding: 10px; background: var(--bg); color: var(--dark); padding-bottom: 80px; }
        .container { max-width: 550px; margin: auto; }

        .header-area { text-align: center; margin-bottom: 15px; background: var(--dark); padding: 15px; border-radius: 12px; color: white; }
        .date-label { font-size: 0.75rem; opacity: 0.8; margin-top: 4px; }

        /* Floating Action Button */
        .fab {
            position: fixed; bottom: 25px; right: 25px; 
            width: 60px; height: 60px; background: var(--primary);
            color: white; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; font-size: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: none; cursor: pointer; z-index: 999;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); display: none; /* Hidden by default */
            align-items: center; justify-content: center; z-index: 1000;
        }
        .modal-content {
            background: white; width: 90%; max-width: 400px;
            padding: 25px; border-radius: 15px; display: flex; flex-direction: column; gap: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .modal-header { font-weight: bold; font-size: 1.2rem; margin-bottom: 5px; }
        input, select { width: 100%; box-sizing: border-box; padding: 14px; border: 1px solid #d1d9e0; border-radius: 8px; font-size: 16px; }

        .filter-wrapper { position: sticky; top: 0; z-index: 100; background: var(--bg); padding: 10px 0; border-bottom: 1px solid #ddd; }
        .filter-container { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; }
        .filter-container::-webkit-scrollbar { display: none; }
        .filter-btn { white-space: nowrap; padding: 7px 14px; border-radius: 20px; border: 1.5px solid var(--primary); background: white; color: var(--primary); font-weight: 600; cursor: pointer; font-size: 12px; }
        .filter-btn.active { background: var(--primary); color: white; }

        .item-card { 
            display: block; background: var(--white); margin-bottom: 12px; padding: 15px; 
            border-radius: 12px; position: relative; border: 1px solid #eef0f2;
            transition: background-color 0.4s ease; scroll-margin-top: 80px;
        }
        
        .pulse-highlight { animation: pulse-green 1.2s ease-out; }
        @keyframes pulse-green {
            0% { background-color: #d4edda; }
            100% { background-color: var(--white); }
        }

        .important-row { background-color: var(--important) !important; border: 1.5px solid var(--imp-border) !important; }
        .sn-badge { position: absolute; top: 12px; left: 12px; background: var(--dark); color: white; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-size: 11px; font-weight: bold; }
        .card-content { margin-left: 30px; }
        .item-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .item-title { font-weight: 700; font-size: 16px; }
        .item-qty { background: #f1f5f9; padding: 2px 8px; border-radius: 5px; font-size: 12px; font-weight: 600; }
        .item-meta { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .cat-tag { font-size: 10px; font-weight: 700; color: #718096; text-transform: uppercase; background: #edf2f7; padding: 3px 6px; border-radius: 4px; }
        .btn-icon { width: 34px; height: 34px; border-radius: 8px; border: none; color: white; cursor: pointer; }
        .btn-main { background: var(--primary); color: white; border: none; padding: 14px; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-area">
        <h2>üè† GM House Groceries</h2>
        <div id="displayDate" class="date-label"></div>
    </div>

    <div class="filter-wrapper">
        <div class="filter-container">
            <button class="filter-btn active" onclick="filterList('All', this)">All Items</button>
            <button class="filter-btn" onclick="filterList('Food', this)">Food</button>
            <button class="filter-btn" onclick="filterList('Gharam Masala', this)">Masala</button>
            <button class="filter-btn" onclick="filterList('Shower', this)">Personal Care</button>
            <button class="filter-btn" onclick="filterList('Cloth Wash', this)">Laundry</button>
            <button class="filter-btn" onclick="filterList('General Food', this)">Snacks</button>
            <button class="filter-btn" onclick="filterList('Kitchen', this)">Kitchen</button>
            <button class="filter-btn" onclick="filterList('Misc', this)">Misc</button>
        </div>
    </div>

    <div id="listBody"></div>

    <button class="btn-main" style="background:var(--dark); width:100%; margin: 20px 0;" onclick="exportPDF()">üì• DOWNLOAD PDF</button>
</div>

<div class="modal-overlay" id="itemModal">
    <div class="modal-content">
        <div class="modal-header" id="modalTitle">Add New Item</div>
        <input type="text" id="itemName" placeholder="Item Name">
        <input type="text" id="itemQty" placeholder="Qty">
        <select id="itemCat">
            <option value="Food">üç≤ Food</option>
            <option value="Gharam Masala">üå∂Ô∏è Masala</option>
            <option value="Shower">üöø Personal Care</option>
            <option value="Cloth Wash">üßº Laundry</option>
            <option value="General Food">üçø Snacks</option>
            <option value="Kitchen">üç≥ Kitchen</option>
            <option value="Misc">üì¶ Misc</option>
        </select>
        <label style="display:flex; align-items:center; gap:10px; cursor:pointer;">
            <input type="checkbox" id="isImportant"> ‚ö†Ô∏è Priority Item
        </label>
        <div style="display:flex; gap:10px;">
            <button class="btn-main" id="submitBtn" onclick="addItem()" style="flex:2;">Save Item</button>
            <button class="btn-main" onclick="closeModal()" style="background:#ccc; flex:1;">Cancel</button>
        </div>
    </div>
</div>

<button class="fab" onclick="openModal()">+</button>

<script>
    const masterData = [
        {name:"Mother Care Shampoo",qty:"1 Bottle",cat:"Shower",important:false},
        {name:"Daal Chini",qty:"50 Rs.",cat:"Gharam Masala",important:false},
        {name:"Ajwain",qty:"50 Rs.",cat:"Gharam Masala",important:false},
        {name:"Laung",qty:"50 Rs.",cat:"Gharam Masala",important:false},
        {name:"Gidamri (imli)",qty:"250 Gram",cat:"Food",important:false},
        {name:"Lahori Namak",qty:"6 pack",cat:"Food",important:false},
        {name:"Till",qty:"100 Rs.",cat:"General Food",important:false},
        {name:"Pulao jeeri",qty:"100 Rs.",cat:"Gharam Masala",important:false},
        {name:"Suki Methi",qty:"2 Pack",cat:"Food",important:false},
        {name:"Masoor Daal",qty:"0.5 KG",cat:"Food",important:false},
        {name:"SunLight Surf",qty:"2 pack (0.5 KG)",cat:"Cloth Wash",important:false},
        {name:"Moom Daal",qty:"0.5 KG",cat:"Food",important:false},
        {name:"Alu Bukhara",qty:"200 Rs.",cat:"Gharam Masala",important:false},
        {name:"lal mirch kuti hui",qty:"3 pack",cat:"Gharam Masala",important:false},
        {name:"Mother Care Soap",qty:"1 Soap",cat:"Shower",important:false},
        {name:"Merry Biscuit",qty:"1 full Pack",cat:"General Food",important:false},
        {name:"Himali Facewash",qty:"1 Pouch",cat:"Shower",important:false},
        {name:"Kala Mirch",qty:"125 Gram",cat:"Gharam Masala",important:false},
        {name:"lemon max",qty:"20 soaps",cat:"Kitchen",important:false},
        {name:"Chana",qty:"1 KG",cat:"Food",important:false},
        {name:"Sabid Dhania",qty:"1 KG",cat:"Food",important:false},
        {name:"Zeera",qty:"250 Gram",cat:"Gharam Masala",important:false},
        {name:"Hand Wash",qty:"1 Bottle",cat:"Shower",important:false},
        {name:"Coconut Oil",qty:"250 Gram",cat:"Misc",important:false},
        {name:"Click Biscuit",qty:"1 full Pack",cat:"General Food",important:false},
        {name:"Dove Lotion",qty:"1 bottle",cat:"Misc",important:false},
        {name:"Safeguard",qty:"4 Medium",cat:"Shower",important:false},
        {name:"Dove Soap",qty:"1 Soap",cat:"Shower",important:false},
        {name:"Kohinoor Soap",qty:"8 Soaps",cat:"Cloth Wash",important:false},
        {name:"Head & Shoulders",qty:"1 Bottle",cat:"Shower",important:false},
        {name:"Gala Biscuit",qty:"1 full Pack",cat:"General Food",important:false},
        {name:"Ponds Facewash",qty:"1 Pouch",cat:"Shower",important:false},
        {name:"Sugar",qty:"8 KG",cat:"Food",important:true},
        {name:"Tissue",qty:"2 Pack",cat:"Misc",important:false},
        {name:"Brit Surf",qty:"5 pack",cat:"Cloth Wash",important:false},
        {name:"Red Rice",qty:"15 KG",cat:"Food",important:false},
        {name:"Super Basmati",qty:"6 KG",cat:"Food",important:false},
        {name:"Mezban Tea",qty:"1.5 KG",cat:"Food",important:false},
        {name:"Oil",qty:"20 Litre",cat:"Food",important:true},
        {name:"Tez pata",qty:"30 Rs.",cat:"Gharam Masala",important:false},
        {name:"Badyan k phool",qty:"50 Rs.",cat:"Gharam Masala",important:false},
        {name:"lal mirch pisi",qty:"1 pack",cat:"Gharam Masala",important:false},
        {name:"Hing",qty:"100 Rs.",cat:"Gharam Masala",important:false},
        {name:"Sonf",qty:"125 Gram",cat:"Gharam Masala",important:false},
        {name:"Dove Shampoo",qty:"1 Bottle",cat:"Shower",important:false}
    ];

    let groceryList = JSON.parse(localStorage.getItem('gm_house_groceries')) || masterData;
    let currentFilter = 'All';
    let editIndex = -1;

    function renderList(highlightName = null) {
        groceryList.sort((a, b) => a.cat.localeCompare(b.cat));
        const container = document.getElementById('listBody');
        container.innerHTML = '';
        
        groceryList.forEach((item, index) => {
            if (currentFilter !== 'All' && item.cat !== currentFilter) return;
            const card = document.createElement('div');
            card.className = `item-card ${item.important ? 'important-row' : ''}`;
            if (highlightName && item.name === highlightName) card.classList.add('pulse-highlight');

            card.innerHTML = `
                <div class="sn-badge">${index + 1}</div>
                <div class="card-content">
                    <div class="item-header"><span class="item-title">${item.name} ${item.important ? '‚≠ê' : ''}</span><span class="item-qty">${item.qty || '-'}</span></div>
                    <div class="item-meta"><span class="cat-tag">${item.cat}</span>
                        <div class="action-btns">
                            <button class="btn-icon" style="background:var(--edit)" onclick="editItem(${index})">‚úé</button>
                            <button class="btn-icon" style="background:var(--danger)" onclick="deleteItem(${index})">‚úï</button>
                        </div>
                    </div>
                </div>`;
            container.appendChild(card);
            if (highlightName && item.name === highlightName) {
                setTimeout(() => card.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);
            }
        });
        localStorage.setItem('gm_house_groceries', JSON.stringify(groceryList));
        document.getElementById('displayDate').innerText = "Last Updated: " + new Date().toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
    }

    function openModal() {
        document.getElementById('itemModal').style.display = 'flex';
        document.getElementById('modalTitle').innerText = editIndex === -1 ? 'Add New Item' : 'Update Item';
        document.getElementById('submitBtn').innerText = editIndex === -1 ? 'Save Item' : 'Update Item';
    }

    function closeModal() {
        document.getElementById('itemModal').style.display = 'none';
        editIndex = -1;
        document.getElementById('itemName').value = '';
        document.getElementById('itemQty').value = '';
        document.getElementById('isImportant').checked = false;
    }

    function filterList(category, btn) {
        currentFilter = category;
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderList();
    }

    function addItem() {
        const name = document.getElementById('itemName').value;
        const qty = document.getElementById('itemQty').value;
        const cat = document.getElementById('itemCat').value;
        const imp = document.getElementById('isImportant').checked;
        if(!name.trim()) return;

        if(editIndex === -1) {
            groceryList.push({ name, qty, cat, important: imp });
        } else {
            groceryList[editIndex] = { name, qty, cat, important: imp };
        }
        
        closeModal();
        renderList(name);
    }

    function editItem(index) {
        const item = groceryList[index];
        editIndex = index;
        document.getElementById('itemName').value = item.name;
        document.getElementById('itemQty').value = item.qty;
        document.getElementById('itemCat').value = item.cat;
        document.getElementById('isImportant').checked = item.important;
        openModal();
    }

    function deleteItem(index) { if(confirm("Remove?")) { groceryList.splice(index, 1); renderList(); } }

    function exportPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const dateStr = new Date().toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
        doc.setFontSize(20);
        doc.text("GM House Groceries", 14, 22);
        const tableData = groceryList.map((item, index) => [index + 1, item.name + (item.important ? ' (PRI)' : ''), item.qty, item.cat]);
        doc.autoTable({ startY: 38, head: [['SN', 'Item', 'Qty', 'Category']], body: tableData, theme: 'grid' });
        doc.save(`GM_Groceries_${dateStr.replace(/ /g, '-')}.pdf`);
    }

    renderList();
</script>
</body>
</html>
