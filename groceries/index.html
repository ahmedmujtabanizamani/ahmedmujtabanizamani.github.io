<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GM House Groceries üè†</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root { 
            --primary: #27ae60; --edit: #f39c12; --danger: #e74c3c; 
            --important: #fff9db; --imp-border: #f1c40f; --dark: #2c3e50;
            --bg: #f0f2f5; --white: #ffffff;
        }

        body { 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; padding: 15px; background: var(--bg); color: var(--dark); 
        }

        .container { 
            max-width: 600px; margin: auto; 
        }

        /* Header UI */
        .header-area { 
            text-align: center; margin-bottom: 25px; 
            background: linear-gradient(135deg, var(--primary), #2ecc71);
            padding: 20px; border-radius: 15px; color: white;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }
        h2 { margin: 0; font-size: 1.6rem; letter-spacing: 1px; }
        .date-label { font-size: 0.85rem; opacity: 0.9; margin-top: 5px; font-weight: 300; }

        /* Input Form UI */
        .controls { 
            background: var(--white); padding: 20px; border-radius: 15px; 
            margin-bottom: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            display: flex; flex-direction: column; gap: 12px;
        }
        
        input, select { 
            width: 100%; box-sizing: border-box; padding: 14px; 
            border: 2px solid #edf2f7; border-radius: 10px; font-size: 16px;
            transition: all 0.3s; background: #fafafa;
        }
        input:focus, select:focus { 
            border-color: var(--primary); outline: none; background: white;
            box-shadow: 0 0 0 4px rgba(46, 204, 113, 0.1);
        }
        
        .checkbox-group { 
            display: flex; align-items: center; gap: 12px; 
            padding: 10px; background: #fff5f5; border-radius: 10px;
            border: 1px dashed #feb2b2; cursor: pointer;
        }
        #isImportant { width: 20px; height: 20px; accent-color: var(--danger); }
        .checkbox-group label { font-size: 14px; font-weight: 600; color: #c53030; }

        .btn-main { 
            background: var(--primary); color: white; border: none; 
            padding: 15px; border-radius: 10px; font-weight: bold; 
            font-size: 16px; cursor: pointer; transition: 0.3s;
        }
        .btn-main:hover { filter: brightness(1.1); }

        /* Mobile Card UI */
        table { width: 100%; border-collapse: collapse; }
        thead { display: none; }
        tr { 
            display: block; background: var(--white); margin-bottom: 20px; 
            padding: 20px; border-radius: 15px; position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02); border: 1px solid #f0f0f0;
        }
        
        /* Floating SN Badge */
        td[data-label="SN"] { 
            position: absolute; top: -12px; left: -12px; 
            background: var(--dark); color: white; width: 32px; height: 32px; 
            display: flex !important; align-items: center; justify-content: center;
            border-radius: 10px; font-size: 14px; font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        td { display: block; text-align: right; padding: 10px 0; font-size: 15px; border-bottom: 1px solid #f7fafc; }
        td:last-child { border: none; }
        td:not([data-label="SN"])::before { 
            content: attr(data-label); float: left; font-weight: 700; color: #a0aec0; text-transform: uppercase; font-size: 11px; margin-top: 3px;
        }
        
        .important-row { 
            background-color: var(--important) !important; 
            border: 1px solid var(--imp-border) !important;
        }

        /* Category Color Coding */
        .cat-tag { 
            background: #edf2f7; color: #4a5568; padding: 5px 12px; 
            border-radius: 8px; font-size: 12px; font-weight: bold; 
        }
        
        /* Actions UX */
        .action-cell { 
            display: flex; justify-content: flex-end; gap: 10px; 
            margin-top: 10px; padding-top: 15px;
        }
        .btn-circle { 
            width: 40px; height: 40px; border-radius: 10px; border: none; 
            color: white; cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 18px; transition: 0.2s;
        }
        .btn-circle:active { transform: scale(0.9); }

        .btn-pdf { 
            background: var(--dark); margin-top: 10px; 
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-area">
        <h2>üè† GM House Groceries</h2>
        <div id="displayDate" class="date-label"></div>
    </div>
    
    <div class="controls">
        <input type="text" id="itemName" placeholder="What do we need? (e.g. Sugar)">
        <input type="text" id="itemQty" placeholder="How much? (e.g. 5 KG)">
        <select id="itemCat">
            <option value="Food">üç≤ Food Items</option>
            <option value="Gharam Masala">üå∂Ô∏è Gharam Masala</option>
            <option value="Shower">üöø Personal Care</option>
            <option value="Cloth Wash">üßº Laundry & Wash</option>
            <option value="General Food">üçø Snacks & Biscuits</option>
            <option value="Kitchen">üç≥ Kitchen Tools</option>
            <option value="Misc">üì¶ Miscellaneous</option>
        </select>
        <div class="checkbox-group" onclick="document.getElementById('isImportant').click()">
            <input type="checkbox" id="isImportant"> 
            <label>‚ö†Ô∏è MARK AS VERY IMPORTANT</label>
        </div>
        <button class="btn-main" id="submitBtn" onclick="addItem()">Add to List</button>
    </div>

    <table id="groceryTable">
        <tbody id="listBody"></tbody>
    </table>

    <button class="btn-main btn-pdf" onclick="exportPDF()">
        <span>üì•</span> DOWNLOAD SHOPPING PDF
    </button>
</div>

<script>
    let groceryList = JSON.parse(localStorage.getItem('gm_house_groceries')) || [];
    let editIndex = -1;

    function renderList() {
        groceryList.sort((a, b) => a.cat.localeCompare(b.cat));
        const body = document.getElementById('listBody');
        body.innerHTML = '';
        
        groceryList.forEach((item, index) => {
            const importantClass = item.important ? 'important-row' : '';
            body.innerHTML += `
                <tr class="${importantClass}">
                    <td data-label="SN">${index + 1}</td>
                    <td data-label="Item"><strong>${item.name}</strong> ${item.important ? 'üî•' : ''}</td>
                    <td data-label="Qty">${item.qty || '-'}</td>
                    <td data-label="Category"><span class="cat-tag">${item.cat}</span></td>
                    <td class="action-cell">
                        <button class="btn-circle" style="background:var(--edit)" onclick="editItem(${index})">‚úé</button>
                        <button class="btn-circle" style="background:var(--danger)" onclick="deleteItem(${index})">‚úï</button>
                    </td>
                </tr>`;
        });
        localStorage.setItem('gm_house_groceries', JSON.stringify(groceryList));
        document.getElementById('displayDate').innerText = "Last Updated: " + new Date().toLocaleDateString('en-GB');
    }

    function addItem() {
        const name = document.getElementById('itemName').value;
        const qty = document.getElementById('itemQty').value;
        const cat = document.getElementById('itemCat').value;
        const imp = document.getElementById('isImportant').checked;
        if(!name.trim()) return;

        if(editIndex === -1) {
            groceryList.push({ name, qty, cat, important: imp });
        } else {
            groceryList[editIndex] = { name, qty, cat, important: imp };
            editIndex = -1;
            document.getElementById('submitBtn').innerText = "Add to List";
            document.getElementById('submitBtn').style.background = "var(--primary)";
        }
        
        document.getElementById('itemName').value = '';
        document.getElementById('itemQty').value = '';
        document.getElementById('isImportant').checked = false;
        renderList();
    }

    function editItem(index) {
        const item = groceryList[index];
        document.getElementById('itemName').value = item.name;
        document.getElementById('itemQty').value = item.qty;
        document.getElementById('itemCat').value = item.cat;
        document.getElementById('isImportant').checked = item.important;
        editIndex = index;
        document.getElementById('submitBtn').innerText = "Update Item Info";
        document.getElementById('submitBtn').style.background = "var(--edit)";
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function deleteItem(index) {
        if(confirm("Remove this item?")) {
            groceryList.splice(index, 1);
            renderList();
        }
    }

    function exportPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFontSize(20);
        doc.setTextColor(40);
        doc.text("GM House Groceries", 14, 22);
        
        doc.setFontSize(10);
        doc.setTextColor(100);
        doc.text(`Generated: ${new Date().toLocaleString()}`, 14, 30);

        const tableData = groceryList.map((item, index) => [
            index + 1,
            item.name + (item.important ? ' (PRIORITY)' : ''),
            item.qty,
            item.cat
        ]);

        doc.autoTable({
            startY: 38,
            head: [['SN', 'Item Description', 'Qty', 'Department']],
            body: tableData,
            theme: 'grid',
            headStyles: { fillColor: [39, 174, 96], fontSize: 11 },
            didParseCell: function(data) {
                if (data.section === 'body' && groceryList[data.row.index].important) {
                    data.cell.styles.fillColor = [255, 249, 219];
                    data.cell.styles.fontStyle = 'bold';
                }
            }
        });
        doc.save(`GM_Groceries_${new Date().toLocaleDateString()}.pdf`);
    }

    renderList();
</script>
</body>
</html>
